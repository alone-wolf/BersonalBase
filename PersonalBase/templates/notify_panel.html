<!DOCTYPE HTML>
<html>

<head>
    <title>Notify Socket Test</title>
    <link crossorigin="anonymous" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
        href="https://lib.baomitu.com/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">

</head>
{% raw %}

<body>
    <div id="app" style="margin: 16px;">

        <div class="panel panel-default">
            <div class="panel-body">
                <h3>notify: {{ notify.notify }}</h3>
                <P>title: {{ notify.title }}</P>
                <P>device: {{ notify.device }}</P>
                <p>webTime: {{ time_stamp }}</p>
                <p>serverConnected: {{ connected }} </p>
            </div>
        </div>

    </div>

</body>
{% endraw %}
<script crossorigin="anonymous" integrity="sha384-nvAa0+6Qg9clwYCGGPpDQLVpLNn0fRaROjHqs13t4Ggj3Ez50XnGQqc/r8MhnRDZ"
    src="https://lib.baomitu.com/jquery/1.12.4/jquery.min.js"></script>
<script crossorigin="anonymous" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
    src="https://lib.baomitu.com/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script crossorigin="anonymous" integrity="sha384-+jvb+jCJ37FkNjPyYLI3KJzQeD8pPFXUra3B/QJFqQ3txYrUPIP1eOfxK4h3cKZP"
    src="https://lib.baomitu.com/vue/2.6.11/vue.js"></script>
<script crossorigin="anonymous" integrity="sha384-zn1vPVAulmXb7m7zo/eHPJOkmryKZUNog1TsyNLdDjCccxcOOGAUyC62x3QNN99x"
    src="https://lib.baomitu.com/axios/0.20.0-0/axios.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"></script>

<script type="text/javascript" charset="utf-8">

    var NAMESPACE = "/notify";

    var ENTRANCE_NOTIFICATION = "en_notify";
    var ENTRANCE_NOTIFICATION_MONITOR_ONLY = "en_notify_monitor_only";

    new Vue({
        el: "#app",
        data: {
            connected: false,
            notify: {
                title: "",
                notify: "",
                device: ""
            },
            socket: "",
            time_stamp: ""
        },
        methods: {
            get_time1: function (time = +new Date()) {
                var date = new Date(time + 8 * 3600 * 1000);
                return date.toJSON().substr(0, 19).replace('T', ' ');
                // 时间戳需要毫秒数 则切取23位
            },
            get_time2: function (time = +new Date()) {
                var date = new Date(time + 8 * 3600 * 1000);
                return date.toJSON().substr(0, 19).replace('T', ' ').replace(/-/g, '.');
            }
        },
        mounted() {
            var that = this;
            this.socket = io(NAMESPACE);
            this.socket.on(ENTRANCE_NOTIFICATION, function (msg) {
                that.notify.notify = msg.notify;
                that.notify.title = msg.title;
                that.notify.device = msg.device;
                that.time_stamp = that.get_time1();

                console.log(ENTRANCE_NOTIFICATION);
                console.log(msg);
            });
            // socket.on(ENTRANCE_NOTIFICATION_MONITOR_ONLY, function (msg) {
            //     console.log(ENTRANCE_NOTIFICATION_MONITOR_ONLY);
            //     console.log(msg);
            // });

            this.socket.on('connect', function () {
                that.connected = true;
                that.socket.emit('my_ping', { data: 'connected to the SocketServer...' });
            });

            this.socket.on('my_pong', function (msg) {
                console.log(msg)
            });

            this.socket.on('disconnect', function () {
                that.connected = false;
                console.log('disconnect')
            });
        }
    });



</script>

</html>